## 🏆 향수 판매 e-커머스
![PERMEATE](https://github.com/user-attachments/assets/43fb274d-3228-4643-bd90-6b227ef9897a)

`서비스 링크` : https://www.permeate.store

## ⚡ 프로젝트 소개

- ‘향기’ 와 관련한 제품을 파는 곳은 많지만, 판매 사이트들이 분산되어 있어 구매자의 입장에서는 검증된 사이트를 찾기 쉽지 않습니다.
- 이에 특정 브랜드에 얽매이지 않고, 다양한 브랜드를 모아 하나의 웹사이트에서 편리하게 구매할 수 있는 e-커머스 사이트입니다.

## 🎲 팀원 소개

<table>
  <tbody>
    <tr>
      <th align="center"><b>리더: 윤문열</b></th>
      <th align="center"><b>팀원: 박원빈</b></th>
      <th align="center"><b>팀원: 이수진</b></th>
      <th align="center"><b>팀원: 이하얀</b></th>
    </tr>
    <tr>
      <td align="center"><img src="https://avatars.githubusercontent.com/u/50113066?v=4" width="100px;" alt="윤문열"/></td>
      <td align="center"><img src="https://avatars.githubusercontent.com/u/119783002?v=4" width="100px;" alt="박원빈"/></td>
      <td align="center"><img src="https://avatars.githubusercontent.com/u/59927808?v=4" width="100px;" alt="이수진"/></td>
      <td align="center"><img src="https://avatars.githubusercontent.com/u/164024424?v=4" width="100px;" alt="이하얀"/></td>
     <tr/>
      <td align="center"><a href="https://github.com/munyeol-Yoon">@munyeol-Yoon</a></td>
      <td align="center"><a href="https://github.com/harry21-kr">@harry21-kr</a></td>
      <td align="center"><a href="https://github.com/leeejin">@leeejin</a></td>
      <td align="center"><a href="https://github.com/hayanLee">@hayanLee</a></td>
    </tr>
  </tbody>
</table>

<br>

## 🌐 개발 환경 및 서비스 아키텍처

<img src="https://github.com/user-attachments/assets/7d5debcf-ce80-41a1-8673-80cf5561f6c8" width="500" height="250" />

- Front : Next.js, TailwindCSS
- Database : Supabase
- 버전 및 이슈관리 : Github,
- 협업 툴 : Slack, [노션](https://overjoyed-sailfish-366.notion.site/A01-7ff054801c5248918d0e609cea0ee69f),
- 서비스 배포 환경 : Vercel
- 디자인 : [피그마 초안](<https://www.figma.com/design/6dWRGI558B8vqBEugv0hU6/Permu-(%ED%8D%BC%EB%AE%A4)?node-id=0-1&t=86ug6rbrmCa8dPyQ-0>)

  
## 🍳 사용 기술

![NPM](https://img.shields.io/badge/NPM-%23CB3837.svg?style=for-the-badge&logo=npm&logoColor=white)![ESLint](https://img.shields.io/badge/ESLint-4B3263?style=for-the-badge&logo=eslint&logoColor=white)![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white)![Next JS](https://img.shields.io/badge/Next-black?style=for-the-badge&logo=next.js&logoColor=white)![TailwindCSS](https://img.shields.io/badge/tailwindcss-%2338B2AC.svg?style=for-the-badge&logo=tailwind-css&logoColor=white)![Shadcn/UI](https://img.shields.io/badge/shadcn%2Fui-000000?style=for-the-badge&logo=shadcnui&logoColor=white)![Lodash](https://img.shields.io/badge/Lodash-3492FF?style=for-the-badge&logo=lodash&logoColor=white")![Supabase](https://img.shields.io/badge/Supabase-181818?style=for-the-badge&logo=supabase&logoColor=white)![Figma](https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white)
 
## 역할 분담
#### ➡️ 윤문열
- 카테고리 페이지
- 검색 페이지
- 상품 목록 페이지
#### ➡️ 박원빈
- 장바구니 페이지
- 주문 페이지
#### ➡️ 이수진
- 메인 페이지
- 상품 디테일 페이지
- 리뷰 페이지
#### ➡️ 이하얀
- 로그인(로컬,소셜),로그아웃,회원가입
- 마이페이지
- UI

## 개발 기간
- 전체 개발 기간 2024-07-16~2024-08-21
- 아이디어 / 기술스택 선정 2024-07-16~2024-07-19
- 와이어프레임 / URL 구조 / 역할 분배 2024-07-17~2024-07-21
- DB테이블 생성 및 디자인, 기능 개발 2024-07-18~2024-08-04
- MVP 완성 2024-08-05
- UT 후 추가 기능 개발 및 개선 2024-08-05~2024-08-16
- 최종 마무리 ~2024-08-21
  
## 핵심 기술
- 주문 ( 카카오 주소 api, Toss payment SDK)

## 💡 페이지별 기능

#### 메인페이지
<img src="https://github.com/user-attachments/assets/a2c9af08-2fd4-4675-8407-67aed607d393" width="300" height="400"/>

- 페이지 이동 nav
  - 카테고리, 장바구니, 마이페이지
  - 헤더 탭
  - 메인 캐러셀 아래 배너
- 캐러셀
  - 메인 화면
  - 추천 상품</li>
- 제품 불러오기
  - 주문량 / 최신 제품 / 좋아요 순</li>
- 특정 상품 브랜드 불러오기
  - 캔들, 디퓨저, 딥디크(브랜드)</li>
- 제품마다 좋아요 기능
  
#### 상품상세페이지
<img src="https://github.com/user-attachments/assets/9b9a9633-4425-49bd-97dc-6ef1758c2e69" width="300" height="400"/>

- 장바구니 추가
- 해당 카테고리로 바로가기
- 바로 구매하기
- 카카오톡 공유하기
- 좋아요 기능 (optimisitc)

#### 리뷰페이지
<img src="https://github.com/user-attachments/assets/345b2373-4066-423c-835a-34c9625a553f" width="300" height="400"/>

- 전체 후기 사진 7개만 불러오기
- 상품별 리뷰 불러오기
- 리뷰별 필터링
  - 최신순 / 오랜된 순 / 별점 높은순
- 페이지네이션 ( prefetching )
- 이미지 전체 보기 클릭 시
  - 뷰 전체 사진 불러오기

#### 상품 주문/결제페이지
<img src="https://github.com/user-attachments/assets/5693e5f9-44d5-4593-b02e-ed0322cc0ac2" width="300" height="400"/>

- 비로그인 시 로컬 스토리지만 사용
- 로그인 시 로컬 스토리지 +DB 사용
- 상세 페이지에서 상품 추가 기능
- 구매할 상품의 상태 변경 가능
  - 상품 삭제
  - 상품 옵션 변경
  - 상품 구매 여부 변경
  
<img src="https://github.com/user-attachments/assets/0160de0e-9c43-40be-b81f-889790c3e48a" width="300" height="400"/>

- 배송지 변경 가능 (마이페이지)
- 배송 메모 변경 가능
- 구매할 상품의 정보 확인 가능
- 사용할 마일리지 변경 가능
- 사용할 쿠폰 변경 가능
- 결제 수단 선택 가능
   - 카카오페이, 토스페이
- 최종 금액 확인 가능

#### 상품 결과 필터링페이지

<img src="https://github.com/user-attachments/assets/cf3275e6-e2b8-4f65-8eb0-2b9e6c49abcd" width="300" height="400"/>

- 상품 결과에 대한 편의성을 위해 필터링 제공
  - 가격별

#### 검색페이지

<img src="https://github.com/user-attachments/assets/c2a3b619-e5d4-4b8c-ab24-743d9c276055" width="300" height="400"/>

- 카테고리 불러오기
- 로컬 스토리지를 활용한 최근 검색어 추가 및 삭제
- 디바운싱을 활용한 연관 검색어
- 연관 상품, 카테고리, 키워드 조회


#### 로그인/회원가입

<img src="https://github.com/user-attachments/assets/0d52a874-9fb0-4a9f-aca9-31deaf6b8a22" width="300" height="400"/>

- 이메일
  - 이메일 인증 (OTP)
- OAuth (카카오/구글)
- 회원가입 시, 유저 추가정보 입력 폼 제공


#### 마이페이지

<img src="https://github.com/user-attachments/assets/9e28a6b2-0d64-429f-9026-07066aa63837" width="300" height="400"/>

- 마일리지 / 쿠폰 / 후기 페이지
- 주문 내역 / 찜 페이지
- 회원정보 / 배송지 변경 페이지

## 트러블 슈팅
```
🧐 문제 정의
🐌 장바구니가 느리다!

프로젝트 내 장바구니 기능에 대해 부정적인 피드백 중 공통된 피드백은 장바구니가 느리다! 라는 의견이였습니다.
다수의 피드백을 받았고, 개발자 본인도 문제를 인식하고 있음에 해당 이슈에 대해 트러블슈팅을 작성하게 되었습니다.

🤔 정확히 어떤 부분이 느릴까?

1. 장바구니에 상품을 추가해도 바로 적용되지 않고 짧은 딜레이 후 장바구니에 상품이 추가된다!
2. 장바구니에서 구매할 상품의 옵션(수량, 사이즈)을 변경하면 바로 적용되지 않고 딜레이 후 상품의 옵션이 변경된다!
3. 장바구니 내의 상품을 삭제할 때, 바로 적용되지 않고 딜레이 후 상품이 삭제된다!

🤔 단순히 반응이 느린것만 문제일까?

UI가 유저의 인터랙션에 따라 반영되는게 느리다! 라는 문제만 존재한다면 그렇게 심각한 이슈는 아니지만,
실제 주문 페이지에서 주문을 하려고 해도 장바구니에 추가한 상품이 적용되지 않는 현상도 발생합니다.

유저의 입장에서는 "어? 나는 장바구니에 분명 상품을 추가했고, 이 상품을 주문하려고 했는데 왜 반영이 안되어있지?" 혹은
상품 내역을 정확히 확인하지 않는 유저의 경우에는 내가 선택한 제품을 구매하지 못하는 최악의 상황을 맞이할수도 있습니다.

**따라서 단순히 UI가 변경되지 않는다! 라는 이슈보다 더 심각한, 하나의 거대한 버그라고 인지하고 해당 버그를 수정하고자합니다.**

❓ 문제 원인
📡  항상 서버와 통신하는 장바구니

이슈를 파악해본 결과 원인은 굉장히 단순하였습니다.
바로 장바구니에 상품을 담거나, 수정, 삭제할 경우 항상 서버와의 통신이 일어나고 있었다는 점이였죠.

항상 서버와의 통신으로 인해 UI에 반영되는 속도가 늦어지고,
서버와의 통신이 일어나고있는 도중 주문을 하려고 했을때,
즉, 서버에 새로운 상품의 정보를 장바구니에 추가하려고 하는 도중 주문을 하려고 주문 페이지로 넘어가게되면
주문 페이지에서는 최신 장바구니를 반영하지 못한 이전의 장바구니 내역을 보여주고, 결제까지 진행하게 되는 것이죠.

🛠️ 고민 내역
1. 서버와의 통신이 완료될때까지 유저의 행동을 제한한다.

서버와 통신하는 시간동안 UI에는 로딩 스피너와 같은 UI를 표시해주고, 서버와의 통신이 완료될때까지 유저가 다른 행동을 하지 못하게
클라이언트에서 행동을 제한할 수도 있을 것 같습니다.

실제로 이런 솔루션을 사용하고있는 이커머스 사이트는 쿠팡이 있습니다.
쿠팡은 장바구니에서 무언가를 수정, 삭제할 때 구매하기 버튼을 `disabled` 시켜 유저로부터 하여금 서버와의 통신이 종료될때까지
주문 페이지에 가지 못하도록 제한하고 있습니다.

2. 매 수정마다 서버와 통신하지 않는다.

서버와 통신하는 시간이 문제라면, 서버와 통신하는 부분을 없애버릴수도 있겠다는 생각이 들었습니다.
물론 아예 유저의 장바구니 정보가 DB에 저장되지 않는것은 아닙니다.

먼저 장바구니에서 일어나는 추가/수정/삭제와 관련한 부분은 로컬 스토리지에 정보들을 저장한 뒤,
저장된 정보들을 장바구니가 언마운트 될 때, 즉 사이트의 이동이나 유저의 액션이 일어났을 때 DB에 저장을 해주는 것입니다.

하지만 위 방법도 결국에는 서버와 통신하는 시간이 필연적으로 발생하게 되고, 로딩 중이라는 UI는 공통적으로 표현해주어야 합니다.

또한 위 방법으로 문제를 해결하였을떄의 발생할 이슈는 사용자가 브라우저를 종료하였을때에는 React가 언마운트를 감지하지 못하여
창을 강제종료하였을때는 저장이 되지 않는다는 점입니다.

❗️ 문제 해결

기존 로직
로그인 상태
`장바구니 페이지 마운트`
→ `해당 유저의 기존 장바구니를 가져와 setState()` 
→ `매 수정이 일어날때마다 DB에 장바구니 정보 저장` 

비로그인 상태
`장바구니 사용 불가능`

변경된 로직
로그인 상태

`유저 로그인 시 해당 유저의 기존 장바구니를 가져와 로컬스토리지에 저장` 
`장바구니 페이지 마운트`
→ `로컬스토리지에 있는 장바구니 정보를 가져와 setState()`
→ `매 수정이 일어날때마다 로컬에 장바구니 정보 저장`
→ `장바구니 페이지 언마운트 시 DB에 해당 유저 장바구니 정보 저장` 

비로그인 상태
`장바구니 정보를 로컬스토리지에 저장` 
만약 유저가 `로그인` 시,
`로컬스토리지에 있는 상품` + `DB에 있던 유저의 기존 장바구니 정보`
로컬스토리지를 적극적으로 활용하면서 

1. 기존 장바구니가 느리다는 피드백을 개선
2. 추가하거나 수정, 삭제한 제품이 주문 시 포함되는 이슈 해결
3. 로그인을 하지않은 유저도 장바구니를 사용할 수 있도록 개선

이 되었습니다.
```

## 개선 목표
#### 추후 개발
- 리펙토링
- 판매자,브랜드, 이벤트 페이지 구현
- 주문 취소/환불
- 아이디/비밀번호 찾기
- 고객센터
#### 기술적인 도전 계획
- 페이지 성능 최적화
- 데이터 보안 강화
- 1:1 문의 챗봇 도입
  

## 프로젝트 구조

```
📦src
 ┣ 📂api                # api 호출 및 관련 함수 정의
 ┣ 📂app
 ┃ ┣ 📂(provider)       # global provider 설정
 ┃ ┃ ┣ 📂(root)         # 최상위 루트 레이아웃 설정
 ┃ ┃ ┃ ┣ layout.tsx
 ┃ ┃ ┃ ┗ page.tsx
 ┃ ┃ ┗ layout.tsx
 ┃ ┣ 📂api              # route handler
 ┃ ┗ layout.tsx
 ┣ 📂assets             # 정적 파일
 ┣ 📂components         # 재사용 UI 컴포넌트
 ┣ 📂constant           # 상수값 모음
 ┣ 📂hooks 
 ┃ ┣ 📂mutation         # mutation hooks
 ┃ ┣ 📂query            # query hooks
 ┃ ┣ ...                # 커스텀 훅
 ┣ 📂providers          # provider 
 ┣ 📂supabase           # supabase 설정 파일
 ┣ 📂types              # 타입 선언
 ┣ 📂utils              # 유틸함수
 ┗ middleware.ts      # 전역 미들웨어 설정

```
